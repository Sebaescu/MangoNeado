# Sistema de Etiquetado Autom√°tico de Mangos ü•≠

## MangoNeado - Mangosa S.A.

Sistema de simulaci√≥n para automatizaci√≥n de l√≠nea de empacado de mangos mediante robots coordinados.

---

## üìã Contenido

1. [Descripci√≥n](#descripci√≥n)
2. [Requisitos](#requisitos)
3. [Instalaci√≥n](#instalaci√≥n)
4. [Uso R√°pido](#uso-r√°pido)
5. [Ejemplos](#ejemplos)
6. [Archivos del Proyecto](#archivos-del-proyecto)
7. [Soluci√≥n de Problemas](#soluci√≥n-de-problemas)

---

## üìñ Descripci√≥n

Este proyecto simula un sistema de producci√≥n donde:

- **Banda transportadora** mueve cajas con mangos a velocidad constante
- **Robots coordinados** etiquetan cada mango exactamente una vez
- **Visi√≥n artificial** (simulada) detecta la posici√≥n de cada mango
- **IPC (memoria compartida + sem√°foros)** coordina los robots sin condiciones de carrera
- **Sistema de redundancia** maneja fallos de robots autom√°ticamente

### Caracter√≠sticas Principales

‚úÖ **Multi-proceso**: Cada robot es un proceso independiente  
‚úÖ **Sin condiciones de carrera**: Sincronizaci√≥n con sem√°foros POSIX  
‚úÖ **Eficiente**: Memoria compartida para comunicaci√≥n de alta velocidad  
‚úÖ **Redundancia**: Recuperaci√≥n autom√°tica ante fallos  
‚úÖ **An√°lisis**: Determina el n√∫mero √≥ptimo de robots autom√°ticamente  
‚úÖ **Portable**: C√≥digo POSIX est√°ndar (Linux/Unix)  

---

## üîß Requisitos

### Sistema Operativo
- **Linux** (Ubuntu, Debian, Fedora, etc.)
- **macOS** (con algunas limitaciones en IPC)
- **Windows** mediante WSL2 (Windows Subsystem for Linux)

> ‚ö†Ô∏è **IMPORTANTE PARA WINDOWS**: Este proyecto usa caracter√≠sticas POSIX (memoria compartida, sem√°foros, fork) que **NO est√°n disponibles en Windows nativo** (ni con MSYS2/MinGW). **Debes usar WSL2**.

### Herramientas
```bash
gcc >= 7.0
make
librt (incluida en glibc)
libpthread (incluida en glibc)
libm (biblioteca matem√°tica)
```

---

## üöÄ Instalaci√≥n

### ü™ü Instalaci√≥n en Windows (WSL2)

#### Paso 1: Instalar WSL2

1. Abrir PowerShell como **Administrador** y ejecutar:
```powershell
wsl --install
```

2. Reiniciar el computador cuando se solicite

3. Al reiniciar, se abrir√° autom√°ticamente Ubuntu. Crear usuario y contrase√±a cuando se pida

4. Si no se abre autom√°ticamente, buscar "Ubuntu" en el men√∫ inicio

#### Paso 2: Instalar herramientas de compilaci√≥n en WSL

Dentro de la terminal WSL (Ubuntu), ejecutar:
```bash
sudo apt update
sudo apt install build-essential
```

#### Paso 3: Navegar al proyecto

Tu disco C:\ est√° montado en `/mnt/c/` en WSL. Navegar as√≠:
```bash
cd /mnt/c/Users/TU_USUARIO/Documents/github/MangoNeado
```

Ejemplo:
```bash
cd /mnt/c/Users/thepi/Documents/github/MangoNeado
```

#### Paso 4: Compilar el proyecto

```bash
make all
```

Si la compilaci√≥n es exitosa, ver√°s:
```
‚úì Funciones core compiladas
‚úì Programa principal compilado: mango_simulator
‚úì Programa de an√°lisis compilado: mango_analysis
```

#### Paso 5: Ejecutar

```bash
./mango_simulator 10 50 200 4 6
```

---

### üêß Instalaci√≥n en Linux

#### Paso 1: Instalar dependencias (Ubuntu/Debian)
```bash
sudo apt-get update
sudo apt-get install build-essential
```

Para Fedora/RHEL:
```bash
sudo dnf groupinstall "Development Tools"
```

#### Paso 2: Compilar

```bash
cd MangoNeado/
make all
```

Si la compilaci√≥n es exitosa, ver√°s:
```
‚úì Programa principal compilado: mango_simulator
‚úì Programa de an√°lisis compilado: mango_analysis
```

#### Paso 3: Verificar

```bash
./mango_simulator 10 50 200 4 6
```

---

## ‚ö° Uso R√°pido

### Comandos B√°sicos del Makefile

```bash
make all             # Compilar todos los programas
make test            # Prueba r√°pida del simulador
make test-analysis   # Probar b√∫squeda de robots √≥ptimos
make test-curve      # Probar generaci√≥n de curva
make test-all        # Ejecutar todas las pruebas
make clean           # Limpiar archivos compilados
make clean-ipc       # Limpiar recursos IPC del sistema
make help            # Ver ayuda completa
```

### Simulaci√≥n Manual

```bash
./mango_simulator <velocidad> <tama√±o_caja> <longitud_banda> <robots> <mangos> [prob_fallo] [usar_redundancia]
```

**Par√°metros:**
- **velocidad**: Velocidad de la banda transportadora (cm/s)
- **tama√±o_caja**: Tama√±o de la caja (cm √ó cm)
- **longitud_banda**: Longitud total de la banda (cm)
- **robots**: N√∫mero de robots a utilizar
- **mangos**: N√∫mero de mangos en la caja
- **prob_fallo** (opcional): Probabilidad de fallo de robots (0.0-1.0)
- **usar_redundancia** (opcional): 1 para activar redundancia, 0 para desactivar

**Ejemplo b√°sico**:
```bash
./mango_simulator 10 50 200 4 6
```

**Ejemplo con redundancia**:
```bash
./mango_simulator 10 50 200 5 20 0.05 1
```

### An√°lisis de Optimizaci√≥n

```bash
# Modo 1: Encontrar n√∫mero √≥ptimo de robots
./mango_analysis 1 <num_mangos> <num_simulaciones>

# Modo 2: Generar curva robots vs mangos
./mango_analysis 2 <min_mangos> <max_mangos> <incremento> <num_simulaciones>

# Modo 3: An√°lisis con redundancia
./mango_analysis 3 <num_mangos> <robots_base> <prob_fallo> <num_simulaciones>
```

**Ejemplos**:
```bash
./mango_analysis 1 20 5        # Encontrar robots para 20 mangos
./mango_analysis 2 10 40 5 3   # Curva de 10-40 mangos
./mango_analysis 3 25 5 0.1 5  # Redundancia con 10% fallo
```

---

## üìö Ejemplos

### Ejemplo 1: Configuraci√≥n B√°sica

```bash
./mango_simulator 10 50 200 4 6
```

**Salida esperada**:
```
=== INICIANDO SIMULACI√ìN ===
Mangos: 6 | Robots: 4 | Velocidad: 10.00 cm/s | Caja: 50.00 cm

[Robot 0] Iniciado en posici√≥n 25.00 cm (zona: 0.00 - 50.00)
[Robot 1] Iniciado en posici√≥n 75.00 cm (zona: 50.00 - 100.00)
[Robot 2] Iniciado en posici√≥n 125.00 cm (zona: 100.00 - 150.00)
[Robot 3] Iniciado en posici√≥n 175.00 cm (zona: 150.00 - 200.00)
[Robot 0] Etiquet√≥ mango 0 en (2.66, 3.20) - Tiempo: 1.664s
[Robot 0] Etiquet√≥ mango 1 en (-2.24, 6.34) - Tiempo: 2.691s
[Robot 1] Etiquet√≥ mango 2 en (-0.61, -2.21) - Tiempo: 0.917s
...
=== SIMULACI√ìN COMPLETADA ===
Mangos etiquetados: 6 / 6

‚úì √âXITO: Todos los mangos fueron etiquetados
```

### Ejemplo 2: An√°lisis - Encontrar Robots √ìptimos

```bash
./mango_analysis 1 6 2
```

Ejecuta 2 simulaciones para encontrar el n√∫mero m√≠nimo de robots necesarios para 6 mangos con 95% de tasa de √©xito.

**Salida**:
```
=== BUSCANDO N√öMERO √ìPTIMO DE ROBOTS ===
Objetivo: 95% tasa de √©xito
Mangos: 6

Analizando: 1 robots, 6 mangos
  [1/2] ‚úó Fallo: 1/6 etiquetados (0.03s)
  [2/2] ‚úó Fallo: 2/6 etiquetados (0.03s)
Resultado: 1 robots ‚Üí 0% √©xito

Analizando: 2 robots, 6 mangos
  [1/2] ‚úó Fallo: 4/6 etiquetados (0.03s)
  [2/2] ‚úó Fallo: 3/6 etiquetados (0.03s)
Resultado: 2 robots ‚Üí 0% √©xito

Analizando: 3 robots, 6 mangos
  [1/2] ‚úì √âxito (0.03s)
  [2/2] ‚úì √âxito (0.02s)
Resultado: 3 robots ‚Üí 100% √©xito

‚úì N√∫mero √≥ptimo encontrado: 3 robots
```

**Nota:** El an√°lisis usa una banda de 300cm (m√°s larga que el simulador) para dar m√°s tiempo de procesamiento y obtener resultados m√°s robustos.

### Ejemplo 3: Generar Curva Completa

```bash
./mango_analysis 2 4 12 2 2
```

Genera una curva desde 4 hasta 12 mangos (incremento de 2) con 2 simulaciones por configuraci√≥n.

**Salida**:
```
=== GENERANDO CURVA ROBOTS VS MANGOS ===
Rango de mangos: 4 - 12 (incremento: 2)
Tasa de √©xito objetivo: 95%
Simulaciones por configuraci√≥n: 2

Procesando: 4 mangos...
Procesando: 6 mangos...
Procesando: 8 mangos...
Procesando: 10 mangos...
Procesando: 12 mangos...

‚úì Curva generada exitosamente
```

**Archivo generado** (`curva_robots_mangos.csv`):
```csv
NumMangos,RobotsM√≠nimos,Tasa√âxito,TiempoPromedio
4,2,1.000,0.015
6,3,1.000,0.025
8,3,1.000,0.032
10,4,1.000,0.041
12,4,1.000,0.048
```

Si tienes gnuplot instalado, se generar√° autom√°ticamente un gr√°fico mostrando la curva.

### Ejemplo 4: An√°lisis con Redundancia

```bash
./mango_analysis 3 12 4 0.1 2
```

Analiza el sistema con 12 mangos, 4 robots base, 10% de probabilidad de fallo, y 2 simulaciones.

**Salida**:
```
=== AN√ÅLISIS CON REDUNDANCIA ===
Probabilidad de fallo: 10.00%

Analizando: 4 robots, 12 mangos, prob_fallo=0.10
  [SISTEMA] Robot 2 ha fallado!
  [1/2] ‚úó Fallo: 9/12 etiquetados (0.04s)
  [2/2] ‚úì √âxito (0.03s)
Resultado: 4 robots ‚Üí 50% √©xito

Analizando: 5 robots, 12 mangos, prob_fallo=0.10
  [SISTEMA] Robot 1 ha fallado!
  [1/2] ‚úì √âxito (0.04s)
  [2/2] ‚úì √âxito (0.03s)
Resultado: 5 robots ‚Üí 100% √©xito

‚úì Redundancia adecuada con 5 robots (100% √©xito con fallo 10%)
```

**Archivo generado** (`analisis_redundancia.csv`):
```csv
NumRobots,NumMangos,ProbFallo,Tasa√âxito,TiempoPromedio
4,12,0.10,0.500,0.035
5,12,0.10,1.000,0.035
```

### Ejemplo 5: Prueba con Banda R√°pida

```bash
./mango_simulator 20 50 300 10 20
```

Banda r√°pida (20 cm/s) requiere m√°s robots para el mismo n√∫mero de mangos. Esta configuraci√≥n usa una banda m√°s larga (300cm) para compensar la velocidad.

### Ejemplo 6: Prueba con Caja Grande

```bash
./mango_simulator 10 80 300 6 30
```

Caja grande (80cm √ó 80cm) con 30 mangos requiere m√°s robots debido al √°rea mayor.

---

## üìÅ Archivos del Proyecto

### C√≥digo Fuente

| Archivo | Descripci√≥n |
|---------|-------------|
| `mango_system.h` | Definiciones de estructuras, constantes y prototipos |
| `mango_main.c` | Programa principal - simulador de etiquetado |
| `mango_analysis.c` | Programa de an√°lisis y optimizaci√≥n |
| `Makefile` | Script de compilaci√≥n automatizada |

### Archivos Generados

| Archivo | Contenido |
|---------|-----------|
| `mango_simulator` | Ejecutable del simulador (compilado) |
| `mango_analysis` | Ejecutable del analizador (compilado) |
| `curva_robots_mangos.csv` | Datos de optimizaci√≥n robots vs mangos |
| `analisis_redundancia.csv` | Resultados de an√°lisis con redundancia |

---

## üéØ Comandos del Makefile

### Compilaci√≥n
```bash
make all          # Compilar todos los programas
make clean        # Limpiar archivos compilados y CSV
make clean-ipc    # Limpiar recursos IPC del sistema
```

### Pruebas
```bash
make test            # Prueba r√°pida del simulador (4 robots, 6 mangos)
make test-analysis   # Prueba b√∫squeda de robots √≥ptimos (6 mangos)
make test-curve      # Prueba generaci√≥n de curva (4-8 mangos)
make test-redundancy # Prueba an√°lisis con redundancia (8 mangos, 10% fallo)
make test-all        # Ejecutar todas las pruebas anteriores
```

### Ayuda
```bash
make help         # Mostrar ayuda completa
```

---

## üêõ Soluci√≥n de Problemas

### Problema: Error de compilaci√≥n "cannot find -lrt"

**Soluci√≥n**:
```bash
sudo apt-get install build-essential
```

### Problema: "Permission denied" al ejecutar

**Soluci√≥n**:
```bash
chmod +x mango_simulator mango_analysis
```

### Problema: "shm_open: Permission denied"

**Causa**: Memoria compartida no disponible o permisos insuficientes

**Soluci√≥n**:
```bash
# Limpiar recursos IPC previos
make clean-ipc

# En algunos sistemas, verificar montaje de /dev/shm
ls -la /dev/shm
```

### Problema: Recursos IPC no se liberan

**Soluci√≥n**:
```bash
# Opci√≥n 1: Usar el makefile
make clean-ipc

# Opci√≥n 2: Manual
ipcs -m  # Ver memoria compartida
ipcrm -m <id>  # Eliminar espec√≠fico

ipcs -s  # Ver sem√°foros
ipcrm -s <id>  # Eliminar espec√≠fico
```

### Problema: "Too many open files"

**Causa**: L√≠mite de recursos del sistema

**Soluci√≥n**:
```bash
# Ver l√≠mites actuales
ulimit -a

# Aumentar l√≠mite de archivos abiertos
ulimit -n 4096
```

### Problema: Simulaci√≥n muy lenta

**Causa**: Muchos mangos o robots

**Soluci√≥n**:
- Reducir n√∫mero de mangos o robots
- Disminuir n√∫mero de simulaciones en an√°lisis
- Aumentar longitud de banda para dar m√°s tiempo a los robots
- Compilar con optimizaci√≥n: agregar `-O3` en CFLAGS del Makefile

### Problema: Resultados no determin√≠sticos

**Causa**: Naturaleza estoc√°stica de la simulaci√≥n

**Soluci√≥n**:
- Aumentar n√∫mero de simulaciones (par√°metro en `mango_analysis`)
- Usar seed fijo en `srand()` para reproducibilidad (debugging)

### Problema: Muchos mangos no son etiquetados

**Causa**: Configuraci√≥n insuficiente (pocos robots, banda muy r√°pida, o banda muy corta)

**Soluci√≥n**:
- Aumentar n√∫mero de robots
- Reducir velocidad de la banda
- Aumentar longitud de la banda (m√°s espacio = m√°s tiempo)
- Usar `./mango_analysis 1 <num_mangos> <sims>` para encontrar el n√∫mero √≥ptimo

### Problema: Gnuplot no muestra gr√°ficos

**Causa**: Gnuplot no instalado

**Soluci√≥n**:
```bash
sudo apt install gnuplot
```

---

## üìä Interpretaci√≥n de Resultados

### CSV: curva_robots_mangos.csv

```csv
NumMangos,RobotsM√≠nimos,Tasa√âxito,TiempoPromedio
20,4,0.967,0.798
```

- **NumMangos**: N√∫mero de mangos en la caja
- **RobotsM√≠nimos**: M√≠nimo n√∫mero de robots para ‚â•95% √©xito
- **Tasa√âxito**: Porcentaje de simulaciones exitosas (0-1)
- **TiempoPromedio**: Tiempo de simulaci√≥n promedio (segundos)

### An√°lisis de Costo-Efectividad

Para determinar el punto √≥ptimo de operaci√≥n:

1. Graficar NumMangos vs RobotsM√≠nimos
2. Identificar la relaci√≥n (t√≠picamente lineal o sublineal)
3. Calcular costo: `Costo_Total = Costo_Robot * Robots + Costo_Fallo * (1 - Tasa√âxito) * Mangos`
4. Seleccionar configuraci√≥n con m√≠nimo costo total

---

## üîí Seguridad y Buenas Pr√°cticas

### ‚úÖ Implementado

- Manejo completo de errores
- Limpieza de recursos garantizada (signal handlers)
- Validaci√≥n de par√°metros de entrada
- Prevenci√≥n de condiciones de carrera
- Programaci√≥n defensiva

### ‚ö†Ô∏è Consideraciones para Producci√≥n

- Agregar logs persistentes (syslog)
- Implementar monitoreo en tiempo real
- Agregar autenticaci√≥n si se usa en red
- Considerar fail-safe mec√°nico adem√°s del software
- Implementar watchdog para procesos colgados

---

## üìà Rendimiento

### Benchmarks T√≠picos (Banda 200cm, velocidad 10cm/s)

| Mangos | Robots | Tiempo Simulaci√≥n | Tasa √âxito |
|--------|--------|-------------------|------------|
| 4 | 2 | ~0.02s | 100% |
| 6 | 3 | ~0.03s | 100% |
| 8 | 4 | ~0.03s | 100% |
| 10 | 4 | ~0.04s | 95%+ |
| 12 | 5 | ~0.05s | 95%+ |

### Escalabilidad

- **Lineal con n√∫mero de mangos**: O(N)
- **Sublineal con n√∫mero de robots**: Speedup hasta R ‚âà N/2
- **Overhead de IPC**: < 5% del tiempo total
- **Memoria compartida**: ~4KB por simulaci√≥n
- **Procesos concurrentes**: Limitado por n√∫mero de CPUs disponibles

### Factores que Afectan el Rendimiento

1. **Velocidad de banda**: M√°s r√°pida = menos tiempo disponible = m√°s robots necesarios
2. **Longitud de banda**: M√°s larga = m√°s espacio = m√°s tiempo para etiquetar
3. **Tama√±o de caja**: Cajas grandes requieren m√°s tiempo de etiquetado por mango
4. **Distancia de mangos**: Mangos m√°s alejados del centro requieren m√°s tiempo
5. **N√∫mero de robots**: M√°s robots = mejor paralelizaci√≥n hasta cierto punto

---

## ü§ù Contribuciones

Este es un proyecto acad√©mico. Para mejoras:

1. Implementar interfaz con hardware real
2. Agregar visualizaci√≥n en tiempo real
3. Optimizar algoritmo de asignaci√≥n
4. Soporte para m√∫ltiples cajas simult√°neas
5. Dashboard web para monitoreo

---

## üìÑ Licencia

Proyecto acad√©mico - Mangosa S.A.  
Uso educativo y de simulaci√≥n.

---

## üë®‚Äçüíª Autor

Desarrollado para el curso de Sistemas Operativos  
ESPOL - Ecuador  
2025

---

## üìû Soporte

Para problemas o preguntas:
1. Revisar este README
2. Consultar el documento de dise√±o t√©cnico
3. Verificar los logs de error
4. Usar `make clean-ipc` si hay problemas con IPC

---

**¬°Feliz etiquetado de mangos! ü•≠ü§ñ**