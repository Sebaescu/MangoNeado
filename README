# Sistema de Etiquetado Autom√°tico de Mangos ü•≠

## MangoNeado - Mangosa S.A.

Sistema de simulaci√≥n para automatizaci√≥n de l√≠nea de empacado de mangos mediante robots coordinados.

---

## üìã Contenido

1. [Descripci√≥n](#descripci√≥n)
2. [Requisitos](#requisitos)
3. [Instalaci√≥n](#instalaci√≥n)
4. [Uso R√°pido](#uso-r√°pido)
5. [Ejemplos](#ejemplos)
6. [Archivos del Proyecto](#archivos-del-proyecto)
7. [Soluci√≥n de Problemas](#soluci√≥n-de-problemas)

---

## üìñ Descripci√≥n

Este proyecto simula un sistema de producci√≥n donde:

- **Banda transportadora** mueve cajas con mangos a velocidad constante
- **Robots coordinados** etiquetan cada mango exactamente una vez
- **Visi√≥n artificial** (simulada) detecta la posici√≥n de cada mango
- **IPC (memoria compartida + sem√°foros)** coordina los robots sin condiciones de carrera
- **Sistema de redundancia** maneja fallos de robots autom√°ticamente

### Caracter√≠sticas Principales

‚úÖ **Multi-proceso**: Cada robot es un proceso independiente  
‚úÖ **Sin condiciones de carrera**: Sincronizaci√≥n con sem√°foros POSIX  
‚úÖ **Eficiente**: Memoria compartida para comunicaci√≥n de alta velocidad  
‚úÖ **Redundancia**: Recuperaci√≥n autom√°tica ante fallos  
‚úÖ **An√°lisis**: Determina el n√∫mero √≥ptimo de robots autom√°ticamente  
‚úÖ **Portable**: C√≥digo POSIX est√°ndar (Linux/Unix)  

---

## üîß Requisitos

### Sistema Operativo
- Linux (Ubuntu, Debian, Fedora, etc.)
- macOS (con algunas limitaciones en IPC)
- WSL2 en Windows

### Herramientas
```bash
gcc >= 7.0
make
librt (incluida en glibc)
libpthread (incluida en glibc)
libm (biblioteca matem√°tica)
```

### Instalaci√≥n de dependencias (Ubuntu/Debian)
```bash
sudo apt-get update
sudo apt-get install build-essential
```

---

## üöÄ Instalaci√≥n

### Paso 1: Clonar o copiar archivos

Aseg√∫rate de tener los siguientes archivos:
```
proyecto/
‚îú‚îÄ‚îÄ mango_system.h          # Header con estructuras y declaraciones
‚îú‚îÄ‚îÄ mango_main.c            # Programa principal de simulaci√≥n
‚îú‚îÄ‚îÄ mango_analysis.c        # Programa de an√°lisis y optimizaci√≥n
‚îú‚îÄ‚îÄ Makefile                # Script de compilaci√≥n
‚îî‚îÄ‚îÄ README.md               # Este archivo
```

### Paso 2: Compilar

```bash
cd proyecto/
make all
```

Si la compilaci√≥n es exitosa, ver√°s:
```
‚úì Programa principal compilado: mango_simulator
‚úì Programa de an√°lisis compilado: mango_analysis
```

### Paso 3: Verificar

```bash
./mango_simulator --help
```

---

## ‚ö° Uso R√°pido

### Prueba Simple

```bash
make test
```

Esto ejecuta una simulaci√≥n con par√°metros por defecto.

### Simulaci√≥n Manual

```bash
./mango_simulator <velocidad> <tama√±o_caja> <longitud_banda> <robots> <mangos>
```

**Ejemplo**:
```bash
./mango_simulator 10 50 200 5 20
```
- Velocidad de banda: 10 cm/s
- Tama√±o de caja: 50 cm √ó 50 cm
- Longitud de banda: 200 cm
- N√∫mero de robots: 5
- N√∫mero de mangos: 20

### An√°lisis de Optimizaci√≥n

```bash
# Generar curva robots vs mangos
./mango_analysis 2 10 40 5 3
```

Esto genera `curva_robots_mangos.csv` con los resultados.

---

## üìö Ejemplos

### Ejemplo 1: Configuraci√≥n B√°sica

```bash
./mango_simulator 10 50 200 3 15
```

**Salida esperada**:
```
=== INICIANDO SIMULACI√ìN ===
Mangos: 15 | Robots: 3 | Velocidad: 10.00 cm/s | Caja: 50.00 cm

[Robot 0] Iniciado en posici√≥n 33.33 cm
[Robot 1] Iniciado en posici√≥n 100.00 cm
[Robot 2] Iniciado en posici√≥n 166.67 cm
[Robot 0] Etiquet√≥ mango 3 en (5.23, -8.41) - Tiempo: 0.382s
[Robot 0] Etiquet√≥ mango 7 en (-3.12, 6.78) - Tiempo: 0.297s
...
=== SIMULACI√ìN COMPLETADA ===
Mangos etiquetados: 15 / 15

‚úì √âXITO: Todos los mangos fueron etiquetados
```

### Ejemplo 2: An√°lisis - Encontrar Robots √ìptimos

```bash
./mango_analysis 1 25 5
```

Esto ejecuta 5 simulaciones para encontrar el n√∫mero m√≠nimo de robots necesarios para 25 mangos con 95% de tasa de √©xito.

**Salida**:
```
=== BUSCANDO N√öMERO √ìPTIMO DE ROBOTS ===
Objetivo: 95% tasa de √©xito
Mangos: 25

Analizando: 4 robots, 25 mangos
  [1/5] ‚úì √âxito (0.85s)
  [2/5] ‚úó Fallo: 23/25 etiquetados (0.82s)
  [3/5] ‚úì √âxito (0.87s)
  ...
Resultado: 4 robots ‚Üí 60% √©xito

Analizando: 5 robots, 25 mangos
  [1/5] ‚úì √âxito (0.91s)
  [2/5] ‚úì √âxito (0.89s)
  ...
Resultado: 5 robots ‚Üí 100% √©xito

‚úì N√∫mero √≥ptimo encontrado: 5 robots
```

### Ejemplo 3: Generar Curva Completa

```bash
./mango_analysis 2 10 40 5 3
```

Genera una curva desde 10 hasta 40 mangos (incremento de 5) con 3 simulaciones por configuraci√≥n.

**Archivo generado** (`curva_robots_mangos.csv`):
```csv
NumMangos,RobotsM√≠nimos,Tasa√âxito,TiempoPromedio
10,2,1.000,0.425
15,3,0.967,0.612
20,4,0.967,0.798
25,5,1.000,0.981
30,6,0.967,1.154
35,7,1.000,1.328
40,8,0.967,1.512
```

### Ejemplo 4: An√°lisis con Redundancia

```bash
./mango_analysis 3 25 5 0.1 5
```

Analiza el sistema con 25 mangos, 5 robots base, 10% de probabilidad de fallo, y 5 simulaciones.

**Salida**:
```
=== AN√ÅLISIS CON REDUNDANCIA ===
Probabilidad de fallo: 10.00%

Analizando: 5 robots, 25 mangos, prob_fallo=0.10
  [SISTEMA] Robot 2 ha fallado!
  [1/5] ‚úó Fallo: 22/25 etiquetados (0.94s)
  ...
Resultado: 5 robots ‚Üí 40% √©xito

Analizando: 6 robots, 25 mangos, prob_fallo=0.10
  [SISTEMA] Robot 1 ha fallado!
  [1/5] ‚úì √âxito (1.02s)
  ...
Resultado: 6 robots ‚Üí 80% √©xito

Analizando: 7 robots, 25 mangos, prob_fallo=0.10
  [SISTEMA] Robot 3 ha fallado!
  [1/5] ‚úì √âxito (1.08s)
  ...
Resultado: 7 robots ‚Üí 100% √©xito

‚úì Redundancia adecuada con 7 robots (100% √©xito con fallo 10%)
```

### Ejemplo 5: Prueba con Banda R√°pida

```bash
./mango_simulator 20 50 200 8 25
```

Banda r√°pida (20 cm/s) requiere m√°s robots para el mismo n√∫mero de mangos.

---

## üìÅ Archivos del Proyecto

### C√≥digo Fuente

| Archivo | Descripci√≥n |
|---------|-------------|
| `mango_system.h` | Definiciones de estructuras, constantes y prototipos |
| `mango_main.c` | Programa principal - simulador de etiquetado |
| `mango_analysis.c` | Programa de an√°lisis y optimizaci√≥n |
| `Makefile` | Script de compilaci√≥n automatizada |

### Archivos Generados

| Archivo | Contenido |
|---------|-----------|
| `mango_simulator` | Ejecutable del simulador (compilado) |
| `mango_analysis` | Ejecutable del analizador (compilado) |
| `curva_robots_mangos.csv` | Datos de optimizaci√≥n robots vs mangos |
| `analisis_redundancia.csv` | Resultados de an√°lisis con redundancia |

---

## üéØ Comandos del Makefile

```bash
make all          # Compilar todo
make clean        # Limpiar archivos compilados
make clean-ipc    # Limpiar recursos IPC del sistema
make test         # Prueba r√°pida
make test-all     # M√∫ltiples pruebas
make analysis     # Generar curva de optimizaci√≥n
make redundancy   # An√°lisis con redundancia
make help         # Ver ayuda
```

---

## üêõ Soluci√≥n de Problemas

### Problema: Error de compilaci√≥n "cannot find -lrt"

**Soluci√≥n**:
```bash
sudo apt-get install build-essential
```

### Problema: "Permission denied" al ejecutar

**Soluci√≥n**:
```bash
chmod +x mango_simulator mango_analysis
```

### Problema: "shm_open: Permission denied"

**Causa**: Memoria compartida no disponible o permisos insuficientes

**Soluci√≥n**:
```bash
# Limpiar recursos IPC previos
make clean-ipc

# En algunos sistemas, verificar montaje de /dev/shm
ls -la /dev/shm
```

### Problema: Recursos IPC no se liberan

**Soluci√≥n**:
```bash
# Opci√≥n 1: Usar el makefile
make clean-ipc

# Opci√≥n 2: Manual
ipcs -m  # Ver memoria compartida
ipcrm -m <id>  # Eliminar espec√≠fico

ipcs -s  # Ver sem√°foros
ipcrm -s <id>  # Eliminar espec√≠fico
```

### Problema: "Too many open files"

**Causa**: L√≠mite de recursos del sistema

**Soluci√≥n**:
```bash
# Ver l√≠mites actuales
ulimit -a

# Aumentar l√≠mite de archivos abiertos
ulimit -n 4096
```

### Problema: Simulaci√≥n muy lenta

**Causa**: Muchos mangos o robots

**Soluci√≥n**:
- Reducir n√∫mero de mangos o robots
- Disminuir n√∫mero de simulaciones en an√°lisis
- Compilar con optimizaci√≥n: agregar `-O3` en CFLAGS del Makefile

### Problema: Resultados no determin√≠sticos

**Causa**: Naturaleza estoc√°stica de la simulaci√≥n

**Soluci√≥n**:
- Aumentar n√∫mero de simulaciones (par√°metro en `mango_analysis`)
- Usar seed fijo en `srand()` para reproducibilidad (debugging)

---

## üìä Interpretaci√≥n de Resultados

### CSV: curva_robots_mangos.csv

```csv
NumMangos,RobotsM√≠nimos,Tasa√âxito,TiempoPromedio
20,4,0.967,0.798
```

- **NumMangos**: N√∫mero de mangos en la caja
- **RobotsM√≠nimos**: M√≠nimo n√∫mero de robots para ‚â•95% √©xito
- **Tasa√âxito**: Porcentaje de simulaciones exitosas (0-1)
- **TiempoPromedio**: Tiempo de simulaci√≥n promedio (segundos)

### An√°lisis de Costo-Efectividad

Para determinar el punto √≥ptimo de operaci√≥n:

1. Graficar NumMangos vs RobotsM√≠nimos
2. Identificar la relaci√≥n (t√≠picamente lineal o sublineal)
3. Calcular costo: `Costo_Total = Costo_Robot * Robots + Costo_Fallo * (1 - Tasa√âxito) * Mangos`
4. Seleccionar configuraci√≥n con m√≠nimo costo total

---

## üîí Seguridad y Buenas Pr√°cticas

### ‚úÖ Implementado

- Manejo completo de errores
- Limpieza de recursos garantizada (signal handlers)
- Validaci√≥n de par√°metros de entrada
- Prevenci√≥n de condiciones de carrera
- Programaci√≥n defensiva

### ‚ö†Ô∏è Consideraciones para Producci√≥n

- Agregar logs persistentes (syslog)
- Implementar monitoreo en tiempo real
- Agregar autenticaci√≥n si se usa en red
- Considerar fail-safe mec√°nico adem√°s del software
- Implementar watchdog para procesos colgados

---

## üìà Rendimiento

### Benchmarks T√≠picos (Intel i5, 8GB RAM)

| Mangos | Robots | Tiempo Simulaci√≥n |
|--------|--------|-------------------|
| 10 | 2 | ~0.4s |
| 20 | 4 | ~0.8s |
| 30 | 6 | ~1.2s |
| 40 | 8 | ~1.5s |

### Escalabilidad

- **Lineal con n√∫mero de mangos**: O(N)
- **Sublineal con n√∫mero de robots**: Speedup hasta R ‚âà N/2
- **Overhead de IPC**: < 5% del tiempo total

---

## ü§ù Contribuciones

Este es un proyecto acad√©mico. Para mejoras:

1. Implementar interfaz con hardware real
2. Agregar visualizaci√≥n en tiempo real
3. Optimizar algoritmo de asignaci√≥n
4. Soporte para m√∫ltiples cajas simult√°neas
5. Dashboard web para monitoreo

---

## üìÑ Licencia

Proyecto acad√©mico - Mangosa S.A.  
Uso educativo y de simulaci√≥n.

---

## üë®‚Äçüíª Autor

Desarrollado para el curso de Sistemas Operativos  
ESPOL - Ecuador  
2025

---

## üìû Soporte

Para problemas o preguntas:
1. Revisar este README
2. Consultar el documento de dise√±o t√©cnico
3. Verificar los logs de error
4. Usar `make clean-ipc` si hay problemas con IPC

---

**¬°Feliz etiquetado de mangos! ü•≠ü§ñ**